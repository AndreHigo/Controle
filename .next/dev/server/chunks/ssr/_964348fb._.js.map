{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/05585611100/Videos/CtrlGastos/Controle/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from \"@supabase/ssr\"\r\nimport { cookies } from \"next/headers\"\r\n\r\nexport async function createClient() {\r\n  const cookieStore = await cookies()\r\n\r\n  return createServerClient(process.env.NEXT_PUBLIC_SUPABASE_URL!, process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!, {\r\n    cookies: {\r\n      getAll() {\r\n        return cookieStore.getAll()\r\n      },\r\n      setAll(cookiesToSet) {\r\n        try {\r\n          cookiesToSet.forEach(({ name, value, options }) => cookieStore.set(name, value, options))\r\n        } catch {\r\n          // The \"setAll\" method was called from a Server Component.\r\n          // This can be ignored if you have proxy refreshing user sessions.\r\n        }\r\n      },\r\n    },\r\n  })\r\n}\r\n\r\nexport { createClient as createServerClient }\r\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,yQAAO;IAEjC,OAAO,IAAA,4SAAkB,sUAAoF;QAC3G,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAAK,YAAY,GAAG,CAAC,MAAM,OAAO;gBAClF,EAAE,OAAM;gBACN,0DAA0D;gBAC1D,kEAAkE;gBACpE;YACF;QACF;IACF;AACF"}},
    {"offset": {"line": 38, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/05585611100/Videos/CtrlGastos/Controle/app/transactions/actions.ts"],"sourcesContent":["\"use server\"\r\n\r\nimport { createClient } from \"@/lib/supabase/server\"\r\nimport { revalidatePath } from \"next/cache\"\r\nimport { redirect } from \"next/navigation\"\r\n\r\nexport async function createTransaction(formData: FormData) {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n\r\n  if (!user) {\r\n    return { error: \"Usuário não autenticado\" }\r\n  }\r\n\r\n  const amount = Number.parseFloat(formData.get(\"amount\") as string)\r\n  const type = formData.get(\"type\") as string\r\n  const creditCardId = (formData.get(\"credit_card_id\") as string) || null\r\n\r\n  const data = {\r\n    user_id: user.id,\r\n    title: formData.get(\"title\") as string,\r\n    amount,\r\n    type,\r\n    category_id: (formData.get(\"category_id\") as string) || null,\r\n    credit_card_id: creditCardId,\r\n    date: formData.get(\"date\") as string,\r\n    description: (formData.get(\"description\") as string) || null,\r\n  }\r\n\r\n  if (creditCardId) {\r\n    // Buscar o cartão atual para pegar o saldo\r\n    const { data: creditCard, error: fetchError } = await supabase\r\n      .from(\"credit_cards\")\r\n      .select(\"balance\")\r\n      .eq(\"id\", creditCardId)\r\n      .eq(\"user_id\", user.id)\r\n      .single()\r\n\r\n    if (fetchError) {\r\n      return { error: \"Erro ao buscar cartão de crédito\" }\r\n    }\r\n\r\n    // Calcular novo saldo (receita adiciona, despesa subtrai)\r\n    const currentBalance = creditCard.balance || 0\r\n    const newBalance = type === \"income\" ? currentBalance + amount : currentBalance - amount\r\n\r\n    // Verificar se há saldo suficiente para despesas\r\n    if (type === \"expense\" && newBalance < 0) {\r\n      return { error: \"Saldo insuficiente no cartão de crédito\" }\r\n    }\r\n\r\n    // Atualizar saldo do cartão\r\n    const { error: updateError } = await supabase\r\n      .from(\"credit_cards\")\r\n      .update({ balance: newBalance })\r\n      .eq(\"id\", creditCardId)\r\n      .eq(\"user_id\", user.id)\r\n\r\n    if (updateError) {\r\n      return { error: \"Erro ao atualizar saldo do cartão\" }\r\n    }\r\n  }\r\n\r\n  const { error } = await supabase.from(\"transactions\").insert(data)\r\n\r\n  if (error) {\r\n    return { error: error.message }\r\n  }\r\n\r\n  revalidatePath(\"/transactions\")\r\n  revalidatePath(\"/dashboard\")\r\n  revalidatePath(\"/credit-cards\")\r\n  redirect(\"/transactions\")\r\n}\r\n\r\nexport async function updateTransaction(id: string, formData: FormData) {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n\r\n  if (!user) {\r\n    return { error: \"Usuário não autenticado\" }\r\n  }\r\n\r\n  const { data: oldTransaction, error: fetchError } = await supabase\r\n    .from(\"transactions\")\r\n    .select(\"*\")\r\n    .eq(\"id\", id)\r\n    .eq(\"user_id\", user.id)\r\n    .single()\r\n\r\n  if (fetchError) {\r\n    return { error: \"Transação não encontrada\" }\r\n  }\r\n\r\n  const amount = Number.parseFloat(formData.get(\"amount\") as string)\r\n  const type = formData.get(\"type\") as string\r\n  const creditCardId = (formData.get(\"credit_card_id\") as string) || null\r\n\r\n  if (oldTransaction.credit_card_id) {\r\n    const { data: oldCard } = await supabase\r\n      .from(\"credit_cards\")\r\n      .select(\"balance\")\r\n      .eq(\"id\", oldTransaction.credit_card_id)\r\n      .single()\r\n\r\n    if (oldCard) {\r\n      const revertedBalance =\r\n        oldTransaction.type === \"income\"\r\n          ? (oldCard.balance || 0) - oldTransaction.amount\r\n          : (oldCard.balance || 0) + oldTransaction.amount\r\n\r\n      await supabase.from(\"credit_cards\").update({ balance: revertedBalance }).eq(\"id\", oldTransaction.credit_card_id)\r\n    }\r\n  }\r\n\r\n  if (creditCardId) {\r\n    const { data: creditCard, error: fetchCardError } = await supabase\r\n      .from(\"credit_cards\")\r\n      .select(\"balance\")\r\n      .eq(\"id\", creditCardId)\r\n      .eq(\"user_id\", user.id)\r\n      .single()\r\n\r\n    if (fetchCardError) {\r\n      return { error: \"Erro ao buscar cartão de crédito\" }\r\n    }\r\n\r\n    const currentBalance = creditCard.balance || 0\r\n    const newBalance = type === \"income\" ? currentBalance + amount : currentBalance - amount\r\n\r\n    if (type === \"expense\" && newBalance < 0) {\r\n      return { error: \"Saldo insuficiente no cartão de crédito\" }\r\n    }\r\n\r\n    const { error: updateError } = await supabase\r\n      .from(\"credit_cards\")\r\n      .update({ balance: newBalance })\r\n      .eq(\"id\", creditCardId)\r\n      .eq(\"user_id\", user.id)\r\n\r\n    if (updateError) {\r\n      return { error: \"Erro ao atualizar saldo do cartão\" }\r\n    }\r\n  }\r\n\r\n  const data = {\r\n    title: formData.get(\"title\") as string,\r\n    amount,\r\n    type,\r\n    category_id: (formData.get(\"category_id\") as string) || null,\r\n    credit_card_id: creditCardId,\r\n    date: formData.get(\"date\") as string,\r\n    description: (formData.get(\"description\") as string) || null,\r\n  }\r\n\r\n  const { error } = await supabase.from(\"transactions\").update(data).eq(\"id\", id).eq(\"user_id\", user.id)\r\n\r\n  if (error) {\r\n    return { error: error.message }\r\n  }\r\n\r\n  revalidatePath(\"/transactions\")\r\n  revalidatePath(\"/dashboard\")\r\n  revalidatePath(\"/credit-cards\")\r\n  redirect(\"/transactions\")\r\n}\r\n\r\nexport async function deleteTransaction(id: string) {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n\r\n  if (!user) {\r\n    return { error: \"Usuário não autenticado\" }\r\n  }\r\n\r\n  const { data: transaction, error: fetchError } = await supabase\r\n    .from(\"transactions\")\r\n    .select(\"*\")\r\n    .eq(\"id\", id)\r\n    .eq(\"user_id\", user.id)\r\n    .single()\r\n\r\n  if (fetchError) {\r\n    return { error: \"Transação não encontrada\" }\r\n  }\r\n\r\n  if (transaction.credit_card_id) {\r\n    const { data: creditCard } = await supabase\r\n      .from(\"credit_cards\")\r\n      .select(\"balance\")\r\n      .eq(\"id\", transaction.credit_card_id)\r\n      .single()\r\n\r\n    if (creditCard) {\r\n      const revertedBalance =\r\n        transaction.type === \"income\"\r\n          ? (creditCard.balance || 0) - transaction.amount\r\n          : (creditCard.balance || 0) + transaction.amount\r\n\r\n      await supabase.from(\"credit_cards\").update({ balance: revertedBalance }).eq(\"id\", transaction.credit_card_id)\r\n    }\r\n  }\r\n\r\n  const { error } = await supabase.from(\"transactions\").delete().eq(\"id\", id).eq(\"user_id\", user.id)\r\n\r\n  if (error) {\r\n    return { error: error.message }\r\n  }\r\n\r\n  revalidatePath(\"/transactions\")\r\n  revalidatePath(\"/dashboard\")\r\n  revalidatePath(\"/credit-cards\")\r\n  return { success: true }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;AAEA;AACA;AACA;AAAA;;;;;;AAEO,eAAe,kBAAkB,QAAkB;IACxD,MAAM,WAAW,MAAM,IAAA,yIAAY;IAEnC,MAAM,EACJ,MAAM,EAAE,IAAI,EAAE,EACf,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IAE/B,IAAI,CAAC,MAAM;QACT,OAAO;YAAE,OAAO;QAA0B;IAC5C;IAEA,MAAM,SAAS,OAAO,UAAU,CAAC,SAAS,GAAG,CAAC;IAC9C,MAAM,OAAO,SAAS,GAAG,CAAC;IAC1B,MAAM,eAAe,AAAC,SAAS,GAAG,CAAC,qBAAgC;IAEnE,MAAM,OAAO;QACX,SAAS,KAAK,EAAE;QAChB,OAAO,SAAS,GAAG,CAAC;QACpB;QACA;QACA,aAAa,AAAC,SAAS,GAAG,CAAC,kBAA6B;QACxD,gBAAgB;QAChB,MAAM,SAAS,GAAG,CAAC;QACnB,aAAa,AAAC,SAAS,GAAG,CAAC,kBAA6B;IAC1D;IAEA,IAAI,cAAc;QAChB,2CAA2C;QAC3C,MAAM,EAAE,MAAM,UAAU,EAAE,OAAO,UAAU,EAAE,GAAG,MAAM,SACnD,IAAI,CAAC,gBACL,MAAM,CAAC,WACP,EAAE,CAAC,MAAM,cACT,EAAE,CAAC,WAAW,KAAK,EAAE,EACrB,MAAM;QAET,IAAI,YAAY;YACd,OAAO;gBAAE,OAAO;YAAmC;QACrD;QAEA,0DAA0D;QAC1D,MAAM,iBAAiB,WAAW,OAAO,IAAI;QAC7C,MAAM,aAAa,SAAS,WAAW,iBAAiB,SAAS,iBAAiB;QAElF,iDAAiD;QACjD,IAAI,SAAS,aAAa,aAAa,GAAG;YACxC,OAAO;gBAAE,OAAO;YAA0C;QAC5D;QAEA,4BAA4B;QAC5B,MAAM,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,SAClC,IAAI,CAAC,gBACL,MAAM,CAAC;YAAE,SAAS;QAAW,GAC7B,EAAE,CAAC,MAAM,cACT,EAAE,CAAC,WAAW,KAAK,EAAE;QAExB,IAAI,aAAa;YACf,OAAO;gBAAE,OAAO;YAAoC;QACtD;IACF;IAEA,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,gBAAgB,MAAM,CAAC;IAE7D,IAAI,OAAO;QACT,OAAO;YAAE,OAAO,MAAM,OAAO;QAAC;IAChC;IAEA,IAAA,8QAAc,EAAC;IACf,IAAA,8QAAc,EAAC;IACf,IAAA,8QAAc,EAAC;IACf,IAAA,gUAAQ,EAAC;AACX;AAEO,eAAe,kBAAkB,EAAU,EAAE,QAAkB;IACpE,MAAM,WAAW,MAAM,IAAA,yIAAY;IAEnC,MAAM,EACJ,MAAM,EAAE,IAAI,EAAE,EACf,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IAE/B,IAAI,CAAC,MAAM;QACT,OAAO;YAAE,OAAO;QAA0B;IAC5C;IAEA,MAAM,EAAE,MAAM,cAAc,EAAE,OAAO,UAAU,EAAE,GAAG,MAAM,SACvD,IAAI,CAAC,gBACL,MAAM,CAAC,KACP,EAAE,CAAC,MAAM,IACT,EAAE,CAAC,WAAW,KAAK,EAAE,EACrB,MAAM;IAET,IAAI,YAAY;QACd,OAAO;YAAE,OAAO;QAA2B;IAC7C;IAEA,MAAM,SAAS,OAAO,UAAU,CAAC,SAAS,GAAG,CAAC;IAC9C,MAAM,OAAO,SAAS,GAAG,CAAC;IAC1B,MAAM,eAAe,AAAC,SAAS,GAAG,CAAC,qBAAgC;IAEnE,IAAI,eAAe,cAAc,EAAE;QACjC,MAAM,EAAE,MAAM,OAAO,EAAE,GAAG,MAAM,SAC7B,IAAI,CAAC,gBACL,MAAM,CAAC,WACP,EAAE,CAAC,MAAM,eAAe,cAAc,EACtC,MAAM;QAET,IAAI,SAAS;YACX,MAAM,kBACJ,eAAe,IAAI,KAAK,WACpB,CAAC,QAAQ,OAAO,IAAI,CAAC,IAAI,eAAe,MAAM,GAC9C,CAAC,QAAQ,OAAO,IAAI,CAAC,IAAI,eAAe,MAAM;YAEpD,MAAM,SAAS,IAAI,CAAC,gBAAgB,MAAM,CAAC;gBAAE,SAAS;YAAgB,GAAG,EAAE,CAAC,MAAM,eAAe,cAAc;QACjH;IACF;IAEA,IAAI,cAAc;QAChB,MAAM,EAAE,MAAM,UAAU,EAAE,OAAO,cAAc,EAAE,GAAG,MAAM,SACvD,IAAI,CAAC,gBACL,MAAM,CAAC,WACP,EAAE,CAAC,MAAM,cACT,EAAE,CAAC,WAAW,KAAK,EAAE,EACrB,MAAM;QAET,IAAI,gBAAgB;YAClB,OAAO;gBAAE,OAAO;YAAmC;QACrD;QAEA,MAAM,iBAAiB,WAAW,OAAO,IAAI;QAC7C,MAAM,aAAa,SAAS,WAAW,iBAAiB,SAAS,iBAAiB;QAElF,IAAI,SAAS,aAAa,aAAa,GAAG;YACxC,OAAO;gBAAE,OAAO;YAA0C;QAC5D;QAEA,MAAM,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,SAClC,IAAI,CAAC,gBACL,MAAM,CAAC;YAAE,SAAS;QAAW,GAC7B,EAAE,CAAC,MAAM,cACT,EAAE,CAAC,WAAW,KAAK,EAAE;QAExB,IAAI,aAAa;YACf,OAAO;gBAAE,OAAO;YAAoC;QACtD;IACF;IAEA,MAAM,OAAO;QACX,OAAO,SAAS,GAAG,CAAC;QACpB;QACA;QACA,aAAa,AAAC,SAAS,GAAG,CAAC,kBAA6B;QACxD,gBAAgB;QAChB,MAAM,SAAS,GAAG,CAAC;QACnB,aAAa,AAAC,SAAS,GAAG,CAAC,kBAA6B;IAC1D;IAEA,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,gBAAgB,MAAM,CAAC,MAAM,EAAE,CAAC,MAAM,IAAI,EAAE,CAAC,WAAW,KAAK,EAAE;IAErG,IAAI,OAAO;QACT,OAAO;YAAE,OAAO,MAAM,OAAO;QAAC;IAChC;IAEA,IAAA,8QAAc,EAAC;IACf,IAAA,8QAAc,EAAC;IACf,IAAA,8QAAc,EAAC;IACf,IAAA,gUAAQ,EAAC;AACX;AAEO,eAAe,kBAAkB,EAAU;IAChD,MAAM,WAAW,MAAM,IAAA,yIAAY;IAEnC,MAAM,EACJ,MAAM,EAAE,IAAI,EAAE,EACf,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IAE/B,IAAI,CAAC,MAAM;QACT,OAAO;YAAE,OAAO;QAA0B;IAC5C;IAEA,MAAM,EAAE,MAAM,WAAW,EAAE,OAAO,UAAU,EAAE,GAAG,MAAM,SACpD,IAAI,CAAC,gBACL,MAAM,CAAC,KACP,EAAE,CAAC,MAAM,IACT,EAAE,CAAC,WAAW,KAAK,EAAE,EACrB,MAAM;IAET,IAAI,YAAY;QACd,OAAO;YAAE,OAAO;QAA2B;IAC7C;IAEA,IAAI,YAAY,cAAc,EAAE;QAC9B,MAAM,EAAE,MAAM,UAAU,EAAE,GAAG,MAAM,SAChC,IAAI,CAAC,gBACL,MAAM,CAAC,WACP,EAAE,CAAC,MAAM,YAAY,cAAc,EACnC,MAAM;QAET,IAAI,YAAY;YACd,MAAM,kBACJ,YAAY,IAAI,KAAK,WACjB,CAAC,WAAW,OAAO,IAAI,CAAC,IAAI,YAAY,MAAM,GAC9C,CAAC,WAAW,OAAO,IAAI,CAAC,IAAI,YAAY,MAAM;YAEpD,MAAM,SAAS,IAAI,CAAC,gBAAgB,MAAM,CAAC;gBAAE,SAAS;YAAgB,GAAG,EAAE,CAAC,MAAM,YAAY,cAAc;QAC9G;IACF;IAEA,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,gBAAgB,MAAM,GAAG,EAAE,CAAC,MAAM,IAAI,EAAE,CAAC,WAAW,KAAK,EAAE;IAEjG,IAAI,OAAO;QACT,OAAO;YAAE,OAAO,MAAM,OAAO;QAAC;IAChC;IAEA,IAAA,8QAAc,EAAC;IACf,IAAA,8QAAc,EAAC;IACf,IAAA,8QAAc,EAAC;IACf,OAAO;QAAE,SAAS;IAAK;AACzB;;;IAxNsB;IAwEA;IA+FA;;AAvKA,8WAAA;AAwEA,8WAAA;AA+FA,8WAAA"}},
    {"offset": {"line": 233, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/05585611100/Videos/CtrlGastos/Controle/.next-internal/server/app/transactions/%5Bid%5D/edit/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {createTransaction as '403801f74ec77030c8c095db8308843c716787424d'} from 'ACTIONS_MODULE0'\nexport {updateTransaction as '60f00d6683e443cd12e9f8415ef52f1771e3c4791f'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}